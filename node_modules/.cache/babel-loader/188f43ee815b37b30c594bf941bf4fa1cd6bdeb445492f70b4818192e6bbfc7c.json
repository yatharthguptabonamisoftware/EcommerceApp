{"ast":null,"code":"import '../../../utils/index.mjs';\nimport { hasOwn } from '@vue/shared';\nfunction getError(action, option, xhr) {\n  let msg;\n  if (xhr.response) {\n    msg = `${xhr.response.error || xhr.response}`;\n  } else if (xhr.responseText) {\n    msg = `${xhr.responseText}`;\n  } else {\n    msg = `fail to ${option.method} ${action} ${xhr.status}`;\n  }\n  const err = new Error(msg);\n  err.status = xhr.status;\n  err.method = option.method;\n  err.url = action;\n  return err;\n}\nfunction getBody(xhr) {\n  const text = xhr.responseText || xhr.response;\n  if (!text) {\n    return text;\n  }\n  try {\n    return JSON.parse(text);\n  } catch (e) {\n    return text;\n  }\n}\nfunction upload(option) {\n  if (typeof XMLHttpRequest === \"undefined\") {\n    return;\n  }\n  const xhr = new XMLHttpRequest();\n  const action = option.action;\n  if (xhr.upload) {\n    xhr.upload.onprogress = function progress(e) {\n      if (e.total > 0) {\n        ;\n        e.percent = e.loaded / e.total * 100;\n      }\n      option.onProgress(e);\n    };\n  }\n  const formData = new FormData();\n  if (option.data) {\n    Object.keys(option.data).forEach(key => {\n      formData.append(key, option.data[key]);\n    });\n  }\n  formData.append(option.filename, option.file, option.file.name);\n  xhr.onerror = function error() {\n    option.onError(getError(action, option, xhr));\n  };\n  xhr.onload = function onload() {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      return option.onError(getError(action, option, xhr));\n    }\n    option.onSuccess(getBody(xhr));\n  };\n  xhr.open(option.method, action, true);\n  if (option.withCredentials && \"withCredentials\" in xhr) {\n    xhr.withCredentials = true;\n  }\n  const headers = option.headers || {};\n  for (const item in headers) {\n    if (hasOwn(headers, item) && headers[item] !== null) {\n      xhr.setRequestHeader(item, headers[item]);\n    }\n  }\n  if (headers instanceof Headers) {\n    headers.forEach((value, key) => {\n      xhr.setRequestHeader(key, value);\n    });\n  }\n  xhr.send(formData);\n  return xhr;\n}\nexport { upload as default };","map":{"version":3,"names":["getError","action","option","xhr","msg","response","error","responseText","method","status","err","Error","url","getBody","text","JSON","parse","e","upload","XMLHttpRequest","onprogress","progress","total","percent","loaded","onProgress","formData","FormData","data","Object","keys","forEach","key","append","filename","file","name","onerror","onError","onload","onSuccess","open","withCredentials","headers","item","hasOwn","setRequestHeader","Headers","value","send"],"sources":["/home/bonami/Desktop/Projects/ECommerce/packages/components/upload/src/ajax.ts"],"sourcesContent":["import { hasOwn } from '@tw-element/utils'\nimport type {\n  TwUploadProgressEvent,\n  TwUploadRequestOptions,\n  TwUploadAjaxError,\n} from './upload.type'\n\nfunction getError(\n  action: string,\n  option: TwUploadRequestOptions,\n  xhr: XMLHttpRequest\n) {\n  let msg: string\n  if (xhr.response) {\n    msg = `${xhr.response.error || xhr.response}`\n  } else if (xhr.responseText) {\n    msg = `${xhr.responseText}`\n  } else {\n    msg = `fail to ${option.method} ${action} ${xhr.status}`\n  }\n\n  const err = new Error(msg) as TwUploadAjaxError\n  err.status = xhr.status\n  err.method = option.method\n  err.url = action\n  return err\n}\n\nfunction getBody(xhr: XMLHttpRequest): XMLHttpRequestResponseType {\n  const text = xhr.responseText || xhr.response\n  if (!text) {\n    return text\n  }\n\n  try {\n    return JSON.parse(text)\n  } catch (e) {\n    return text\n  }\n}\n\nexport default function upload(option: TwUploadRequestOptions) {\n  if (typeof XMLHttpRequest === 'undefined') {\n    return\n  }\n\n  const xhr = new XMLHttpRequest()\n  const action = option.action\n\n  if (xhr.upload) {\n    xhr.upload.onprogress = function progress(e) {\n      if (e.total > 0) {\n        ;(e as TwUploadProgressEvent).percent = (e.loaded / e.total) * 100\n      }\n      option.onProgress(e)\n    }\n  }\n\n  const formData = new FormData()\n\n  if (option.data) {\n    Object.keys(option.data).forEach((key) => {\n      formData.append(key, option.data[key])\n    })\n  }\n\n  formData.append(option.filename, option.file, option.file.name)\n\n  xhr.onerror = function error() {\n    option.onError(getError(action, option, xhr))\n  }\n\n  xhr.onload = function onload() {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      return option.onError(getError(action, option, xhr))\n    }\n\n    option.onSuccess(getBody(xhr))\n  }\n\n  xhr.open(option.method, action, true)\n\n  if (option.withCredentials && 'withCredentials' in xhr) {\n    xhr.withCredentials = true\n  }\n\n  const headers = option.headers || {}\n\n  for (const item in headers) {\n    if (hasOwn(headers, item) && headers[item] !== null) {\n      xhr.setRequestHeader(item, headers[item])\n    }\n  }\n\n  if (headers instanceof Headers) {\n    headers.forEach((value, key) => {\n      xhr.setRequestHeader(key, value)\n    })\n  }\n\n  xhr.send(formData)\n  return xhr\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}