{"ast":null,"code":"import { ref, computed, watch, nextTick, onMounted } from 'vue';\nimport { isNumber, useTimeoutFn, isClient } from '@vueuse/core';\nimport '../../../hooks/index.mjs';\nimport '../../../constants/index.mjs';\nimport '../../../utils/index.mjs';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { useLockscreen } from '../../../hooks/use-lockscreen/index.mjs';\nimport { useModal } from '../../../hooks/use-modal/index.mjs';\nimport { useRestoreActive } from '../../../hooks/use-restore-active/index.mjs';\nconst useDialog = (props, {\n  emit\n}, targetRef) => {\n  let lastPosition = \"\";\n  const visible = ref(false);\n  const closed = ref(false);\n  const rendered = ref(false);\n  const {\n    nextZIndex\n  } = useZIndex();\n  const zIndex = ref(props.zIndex || nextZIndex());\n  let openTimer = void 0;\n  let closeTimer = void 0;\n  const normalizeWidth = computed(() => isNumber(props.width) ? `${props.width}px` : props.width);\n  const style = computed(() => {\n    const style2 = {};\n    const varPrefix = `--tw-dialog`;\n    if (!props.fullscreen) {\n      if (props.top) {\n        style2[`${varPrefix}-margin-top`] = props.top;\n      }\n      if (props.width) {\n        style2[`${varPrefix}-width`] = normalizeWidth.value;\n      }\n    }\n    return style2;\n  });\n  function afterEnter() {\n    emit(\"opened\");\n  }\n  function afterLeave() {\n    emit(\"closed\");\n    emit(UPDATE_MODEL_EVENT, false);\n    if (props.destroyOnClose) {\n      rendered.value = false;\n    }\n  }\n  function beforeLeave() {\n    emit(\"close\");\n  }\n  function open() {\n    closeTimer == null ? void 0 : closeTimer();\n    openTimer == null ? void 0 : openTimer();\n    if (props.openDelay && props.openDelay > 0) {\n      ;\n      ({\n        stop: openTimer\n      } = useTimeoutFn(() => doOpen(), props.openDelay));\n    } else {\n      doOpen();\n    }\n  }\n  function close() {\n    openTimer == null ? void 0 : openTimer();\n    closeTimer == null ? void 0 : closeTimer();\n    if (props.closeDelay && props.closeDelay > 0) {\n      ;\n      ({\n        stop: closeTimer\n      } = useTimeoutFn(() => doClose(), props.closeDelay));\n    } else {\n      doClose();\n    }\n  }\n  function hide(shouldCancel) {\n    if (shouldCancel) return;\n    closed.value = true;\n    visible.value = false;\n  }\n  function handleClose() {\n    if (props.beforeClose) {\n      props.beforeClose(hide);\n    } else {\n      close();\n    }\n  }\n  function onModalClick() {\n    if (props.closeOnClickModal) {\n      handleClose();\n    }\n  }\n  function doOpen() {\n    if (!isClient) {\n      return;\n    }\n    visible.value = true;\n  }\n  function doClose() {\n    visible.value = false;\n  }\n  if (props.lockScroll) {\n    useLockscreen(visible);\n  }\n  if (props.closeOnPressEscape) {\n    useModal({\n      handleClose\n    }, visible);\n  }\n  useRestoreActive(visible);\n  watch(() => props.modelValue, val => {\n    if (val) {\n      closed.value = false;\n      open();\n      rendered.value = true;\n      emit(\"open\");\n      zIndex.value = props.zIndex ? zIndex.value++ : nextZIndex();\n      nextTick(() => {\n        if (targetRef.value) {\n          targetRef.value.scrollTop = 0;\n        }\n      });\n    } else {\n      if (visible.value) {\n        close();\n      }\n    }\n  });\n  watch(() => props.fullscreen, val => {\n    if (!targetRef.value) return;\n    if (val) {\n      lastPosition = targetRef.value.style.transform;\n      targetRef.value.style.transform = \"\";\n    } else {\n      targetRef.value.style.transform = lastPosition;\n    }\n  });\n  onMounted(() => {\n    if (props.modelValue) {\n      visible.value = true;\n      rendered.value = true;\n      open();\n    }\n  });\n  return {\n    afterEnter,\n    afterLeave,\n    beforeLeave,\n    handleClose,\n    onModalClick,\n    close,\n    doClose,\n    closed,\n    style,\n    rendered,\n    visible,\n    zIndex\n  };\n};\nexport { useDialog };","map":{"version":3,"names":["useDialog","props","emit","targetRef","lastPosition","visible","ref","closed","rendered","nextZIndex","useZIndex","zIndex","openTimer","closeTimer","normalizeWidth","computed","isNumber","width","style","style2","varPrefix","fullscreen","top","value","afterEnter","afterLeave","UPDATE_MODEL_EVENT","destroyOnClose","beforeLeave","open","openDelay","stop","useTimeoutFn","doOpen","close","closeDelay","doClose","hide","shouldCancel","handleClose","beforeClose","onModalClick","closeOnClickModal","isClient","lockScroll","useLockscreen","closeOnPressEscape","useModal","useRestoreActive","watch","modelValue","val","nextTick","scrollTop","transform","onMounted"],"sources":["/home/bonami/Desktop/Projects/ECommerce/packages/components/dialog/src/use-dialog.ts"],"sourcesContent":["import { computed, ref, watch, nextTick, onMounted } from 'vue'\nimport { useTimeoutFn, isClient } from '@vueuse/core'\n\nimport {\n  useLockscreen,\n  useRestoreActive,\n  useModal,\n  useZIndex,\n} from '@tw-element/hooks'\nimport { UPDATE_MODEL_EVENT } from '@tw-element/constants'\nimport { isNumber } from '@tw-element/utils'\n\nimport type { CSSProperties, Ref, SetupContext } from 'vue'\nimport type { DialogEmits, DialogProps } from './dialog'\n\nexport const useDialog = (\n  props: DialogProps,\n  { emit }: SetupContext<DialogEmits>,\n  targetRef: Ref<HTMLElement | undefined>\n) => {\n  let lastPosition = ''\n  const visible = ref(false)\n  const closed = ref(false)\n  const rendered = ref(false) // when desctroyOnClose is true, we initialize it as false vise versa\n  const { nextZIndex } = useZIndex()\n  const zIndex = ref(props.zIndex || nextZIndex())\n\n  let openTimer: (() => void) | undefined = undefined\n  let closeTimer: (() => void) | undefined = undefined\n\n  const normalizeWidth = computed(() =>\n    isNumber(props.width) ? `${props.width}px` : props.width\n  )\n\n  const style = computed<CSSProperties>(() => {\n    const style: CSSProperties = {}\n    const varPrefix = `--tw-dialog`\n    if (!props.fullscreen) {\n      if (props.top) {\n        style[`${varPrefix}-margin-top`] = props.top\n      }\n      if (props.width) {\n        style[`${varPrefix}-width`] = normalizeWidth.value\n      }\n    }\n    return style\n  })\n\n  function afterEnter() {\n    emit('opened')\n  }\n\n  function afterLeave() {\n    emit('closed')\n    emit(UPDATE_MODEL_EVENT, false)\n    if (props.destroyOnClose) {\n      rendered.value = false\n    }\n  }\n\n  function beforeLeave() {\n    emit('close')\n  }\n\n  function open() {\n    closeTimer?.()\n    openTimer?.()\n\n    if (props.openDelay && props.openDelay > 0) {\n      ;({ stop: openTimer } = useTimeoutFn(() => doOpen(), props.openDelay))\n    } else {\n      doOpen()\n    }\n  }\n\n  function close() {\n    // if (this.willClose && !this.willClose()) return;\n    openTimer?.()\n    closeTimer?.()\n\n    if (props.closeDelay && props.closeDelay > 0) {\n      ;({ stop: closeTimer } = useTimeoutFn(() => doClose(), props.closeDelay))\n    } else {\n      doClose()\n    }\n  }\n\n  function hide(shouldCancel: boolean) {\n    if (shouldCancel) return\n    closed.value = true\n    visible.value = false\n  }\n\n  function handleClose() {\n    if (props.beforeClose) {\n      props.beforeClose(hide)\n    } else {\n      close()\n    }\n  }\n\n  function onModalClick() {\n    if (props.closeOnClickModal) {\n      handleClose()\n    }\n  }\n\n  function doOpen() {\n    if (!isClient) {\n      return\n    }\n\n    // if (props.willOpen?.()) {\n    //  return\n    // }\n    visible.value = true\n  }\n\n  function doClose() {\n    visible.value = false\n  }\n\n  if (props.lockScroll) {\n    useLockscreen(visible)\n  }\n\n  if (props.closeOnPressEscape) {\n    useModal(\n      {\n        handleClose,\n      },\n      visible\n    )\n  }\n\n  useRestoreActive(visible)\n\n  watch(\n    () => props.modelValue,\n    (val) => {\n      if (val) {\n        closed.value = false\n        open()\n        rendered.value = true // enables lazy rendering\n        emit('open')\n        zIndex.value = props.zIndex ? zIndex.value++ : nextZIndex()\n        // this.$el.addEventListener('scroll', this.updatePopper)\n        nextTick(() => {\n          if (targetRef.value) {\n            targetRef.value.scrollTop = 0\n          }\n        })\n      } else {\n        // this.$el.removeEventListener('scroll', this.updatePopper\n        if (visible.value) {\n          close()\n        }\n      }\n    }\n  )\n\n  watch(\n    () => props.fullscreen,\n    (val) => {\n      if (!targetRef.value) return\n      if (val) {\n        lastPosition = targetRef.value.style.transform\n        targetRef.value.style.transform = ''\n      } else {\n        targetRef.value.style.transform = lastPosition\n      }\n    }\n  )\n\n  onMounted(() => {\n    if (props.modelValue) {\n      visible.value = true\n      rendered.value = true // enables lazy rendering\n      open()\n    }\n  })\n\n  return {\n    afterEnter,\n    afterLeave,\n    beforeLeave,\n    handleClose,\n    onModalClick,\n    close,\n    doClose,\n    closed,\n    style,\n    rendered,\n    visible,\n    zIndex,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}