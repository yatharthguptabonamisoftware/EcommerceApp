{"ast":null,"code":"import { getCurrentInstance, computed, watch } from 'vue';\nconst CHECKED_CHANGE_EVENT = \"checked-change\";\nconst useCheckProps = {\n  data: {\n    type: Array,\n    default() {\n      return [];\n    }\n  },\n  optionRender: Function,\n  placeholder: String,\n  title: String,\n  filterable: Boolean,\n  format: Object,\n  filterMethod: Function,\n  defaultChecked: Array,\n  props: Object\n};\nconst useCheck = (props, panelState) => {\n  const {\n    emit\n  } = getCurrentInstance();\n  const labelProp = computed(() => props.props.label || \"label\");\n  const keyProp = computed(() => props.props.key || \"key\");\n  const disabledProp = computed(() => props.props.disabled || \"disabled\");\n  const filteredData = computed(() => {\n    return props.data.filter(item => {\n      if (typeof props.filterMethod === \"function\") {\n        return props.filterMethod(panelState.query, item);\n      } else {\n        const label = item[labelProp.value] || item[keyProp.value].toString();\n        return label.toLowerCase().includes(panelState.query.toLowerCase());\n      }\n    });\n  });\n  const checkableData = computed(() => {\n    return filteredData.value.filter(item => !item[disabledProp.value]);\n  });\n  const checkedSummary = computed(() => {\n    const checkedLength = panelState.checked.length;\n    const dataLength = props.data.length;\n    const {\n      noChecked,\n      hasChecked\n    } = props.format;\n    if (noChecked && hasChecked) {\n      return checkedLength > 0 ? hasChecked.replace(/\\${checked}/g, checkedLength.toString()).replace(/\\${total}/g, dataLength.toString()) : noChecked.replace(/\\${total}/g, dataLength.toString());\n    } else {\n      return `${checkedLength}/${dataLength}`;\n    }\n  });\n  const isIndeterminate = computed(() => {\n    const checkedLength = panelState.checked.length;\n    return checkedLength > 0 && checkedLength < checkableData.value.length;\n  });\n  const updateAllChecked = () => {\n    const checkableDataKeys = checkableData.value.map(item => item[keyProp.value]);\n    panelState.allChecked = checkableDataKeys.length > 0 && checkableDataKeys.every(item => panelState.checked.includes(item));\n  };\n  const handleAllCheckedChange = value => {\n    panelState.checked = value ? checkableData.value.map(item => item[keyProp.value]) : [];\n  };\n  watch(() => panelState.checked, (val, oldVal) => {\n    updateAllChecked();\n    if (panelState.checkChangeByUser) {\n      const movedKeys = val.concat(oldVal).filter(v => !val.includes(v) || !oldVal.includes(v));\n      emit(CHECKED_CHANGE_EVENT, val, movedKeys);\n    } else {\n      emit(CHECKED_CHANGE_EVENT, val);\n      panelState.checkChangeByUser = true;\n    }\n  });\n  watch(checkableData, () => {\n    updateAllChecked();\n  });\n  watch(() => props.data, () => {\n    const checked = [];\n    const filteredDataKeys = filteredData.value.map(item => item[keyProp.value]);\n    panelState.checked.forEach(item => {\n      if (filteredDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  });\n  watch(() => props.defaultChecked, (val, oldVal) => {\n    if (oldVal && val.length === oldVal.length && val.every(item => oldVal.includes(item))) return;\n    const checked = [];\n    const checkableDataKeys = checkableData.value.map(item => item[keyProp.value]);\n    val.forEach(item => {\n      if (checkableDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  }, {\n    immediate: true\n  });\n  return {\n    labelProp,\n    keyProp,\n    disabledProp,\n    filteredData,\n    checkableData,\n    checkedSummary,\n    isIndeterminate,\n    updateAllChecked,\n    handleAllCheckedChange\n  };\n};\nexport { CHECKED_CHANGE_EVENT, useCheck, useCheckProps };","map":{"version":3,"names":["CHECKED_CHANGE_EVENT","useCheckProps","data","type","Array","default","optionRender","Function","placeholder","String","title","filterable","Boolean","format","Object","filterMethod","defaultChecked","props","useCheck","panelState","emit","getCurrentInstance","labelProp","computed","label","keyProp","key","disabledProp","disabled","filteredData","filter","item","query","value","toString","toLowerCase","includes","checkableData","checkedSummary","checkedLength","checked","length","dataLength","noChecked","hasChecked","replace","isIndeterminate","updateAllChecked","checkableDataKeys","map","allChecked","every","handleAllCheckedChange","watch","val","oldVal","checkChangeByUser","movedKeys","concat","v","filteredDataKeys","forEach","push","immediate"],"sources":["/home/bonami/Desktop/Projects/ECommerce/packages/components/transfer/src/useCheck.ts"],"sourcesContent":["import { computed, getCurrentInstance, watch } from 'vue'\n\nimport type { ExtractPropTypes } from 'vue'\nimport type { TransferPanelState, Key } from './transfer'\n\nexport const CHECKED_CHANGE_EVENT = 'checked-change'\n\nexport const useCheckProps = {\n  data: {\n    type: Array,\n    default() {\n      return []\n    },\n  },\n  optionRender: Function,\n  placeholder: String,\n  title: String,\n  filterable: Boolean,\n  format: Object,\n  filterMethod: Function,\n  defaultChecked: Array,\n  props: Object,\n}\n\nexport const useCheck = (\n  props: ExtractPropTypes<typeof useCheckProps>,\n  panelState: TransferPanelState\n) => {\n  const { emit } = getCurrentInstance()\n\n  const labelProp = computed(() => props.props.label || 'label')\n\n  const keyProp = computed(() => props.props.key || 'key')\n\n  const disabledProp = computed(() => props.props.disabled || 'disabled')\n\n  const filteredData = computed(() => {\n    return props.data.filter((item) => {\n      if (typeof props.filterMethod === 'function') {\n        return props.filterMethod(panelState.query, item)\n      } else {\n        const label = item[labelProp.value] || item[keyProp.value].toString()\n        return label.toLowerCase().includes(panelState.query.toLowerCase())\n      }\n    })\n  })\n\n  const checkableData = computed(() => {\n    return filteredData.value.filter((item) => !item[disabledProp.value])\n  })\n\n  const checkedSummary = computed(() => {\n    const checkedLength = panelState.checked.length\n    const dataLength = props.data.length\n    const { noChecked, hasChecked } = props.format\n\n    if (noChecked && hasChecked) {\n      return checkedLength > 0\n        ? hasChecked\n            .replace(/\\${checked}/g, checkedLength.toString())\n            .replace(/\\${total}/g, dataLength.toString())\n        : noChecked.replace(/\\${total}/g, dataLength.toString())\n    } else {\n      return `${checkedLength}/${dataLength}`\n    }\n  })\n\n  const isIndeterminate = computed(() => {\n    const checkedLength = panelState.checked.length\n    return checkedLength > 0 && checkedLength < checkableData.value.length\n  })\n\n  const updateAllChecked = () => {\n    const checkableDataKeys = checkableData.value.map(\n      (item) => item[keyProp.value]\n    )\n    panelState.allChecked =\n      checkableDataKeys.length > 0 &&\n      checkableDataKeys.every((item) => panelState.checked.includes(item))\n  }\n\n  const handleAllCheckedChange = (value: Key[]) => {\n    panelState.checked = value\n      ? checkableData.value.map((item) => item[keyProp.value])\n      : []\n  }\n\n  watch(\n    () => panelState.checked,\n    (val, oldVal) => {\n      updateAllChecked()\n\n      if (panelState.checkChangeByUser) {\n        const movedKeys = val\n          .concat(oldVal)\n          .filter((v) => !val.includes(v) || !oldVal.includes(v))\n        emit(CHECKED_CHANGE_EVENT, val, movedKeys)\n      } else {\n        emit(CHECKED_CHANGE_EVENT, val)\n        panelState.checkChangeByUser = true\n      }\n    }\n  )\n\n  watch(checkableData, () => {\n    updateAllChecked()\n  })\n\n  watch(\n    () => props.data,\n    () => {\n      const checked = []\n      const filteredDataKeys = filteredData.value.map(\n        (item) => item[keyProp.value]\n      )\n      panelState.checked.forEach((item) => {\n        if (filteredDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    }\n  )\n\n  watch(\n    () => props.defaultChecked,\n    (val, oldVal) => {\n      if (\n        oldVal &&\n        val.length === oldVal.length &&\n        val.every((item) => oldVal.includes(item))\n      )\n        return\n\n      const checked = []\n      const checkableDataKeys = checkableData.value.map(\n        (item) => item[keyProp.value]\n      )\n\n      val.forEach((item) => {\n        if (checkableDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  return {\n    labelProp,\n    keyProp,\n    disabledProp,\n    filteredData,\n    checkableData,\n    checkedSummary,\n    isIndeterminate,\n    updateAllChecked,\n    handleAllCheckedChange,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}